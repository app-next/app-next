<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>APP NEXT</title>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 0; background: #f2f2f2; }
    header { background: #0d6efd; color: white; padding: 1rem; text-align: center; font-size: 1.5rem; }
    main { padding: 1rem; }
    .menu { display: flex; flex-direction: column; gap: 0.75rem; }
    .btn { padding: 1rem; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; font-weight: bold; color: #0d6efd; text-decoration: none; }
    form { display: flex; flex-direction: column; gap: 0.75rem; margin-top: 1rem; }
    input, select, textarea { padding: 0.75rem; border-radius: 6px; border: 1px solid #ccc; font-size: 1rem; }
    button { padding: 0.75rem; background: #0d6efd; color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <header>APP NEXT</header>
  <main>
    <div class="menu" id="menu">
      <a class="btn" onclick="showForm('venta')">Registrar Venta</a>
    </div>

    <div id="formularioVenta" class="hidden">
      <h2>Registrar Venta</h2>
      <form onsubmit="enviarVenta(event)">
        <input type="text" id="cliente" placeholder="Cliente" required>
        <input type="text" id="producto" placeholder="Producto" required>
        <input type="number" id="cantidad" placeholder="Cantidad" required>
        <input type="number" id="precio" placeholder="Precio Unitario" required>
        <select id="forma_pago">
          <option value="efectivo">Efectivo</option>
          <option value="transferencia">Transferencia</option>
          <option value="zinli">Zinli</option>
          <option value="usdt">USDT</option>
        </select>
        <input type="text" id="divisa" placeholder="Divisa (USD, Bs)" required>
        <input type="text" id="asesor" placeholder="Asesor" required>
        <textarea id="comentario" placeholder="Comentario"></textarea>
        <button type="submit">Enviar</button>
        <button type="button" onclick="volverMenu()">Volver</button>
      </form>
    </div>
  </main>

  <script>
    const sheetdbEndpoint = "https://sheetdb.io/api/v1/7merahzf5ighx";

    function showForm(tipo) {
      document.getElementById("menu").classList.add("hidden");
      if (tipo === 'venta') document.getElementById("formularioVenta").classList.remove("hidden");
    }

    function volverMenu() {
      document.getElementById("formularioVenta").classList.add("hidden");
      document.getElementById("menu").classList.remove("hidden");
    }

    function enviarVenta(event) {
      event.preventDefault();
      const cantidad = parseFloat(document.getElementById("cantidad").value);
      const precio = parseFloat(document.getElementById("precio").value);
      const total = cantidad * precio;

      const data = {
        data: {
          fecha: new Date().toISOString().split('T')[0],
          cliente: document.getElementById("cliente").value,
          producto: document.getElementById("producto").value,
          cantidad: cantidad,
          precio_unitario: precio,
          total: total,
          forma_pago: document.getElementById("forma_pago").value,
          divisa: document.getElementById("divisa").value,
          asesor: document.getElementById("asesor").value,
          comentario: document.getElementById("comentario").value
        }
      };

      fetch(sheetdbEndpoint + "/sheet/Ventas", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      })
      .then(res => res.json())
      .then(response => {
        alert("Venta registrada con Ã©xito");
        volverMenu();
      })
      .catch(err => {
        console.error(err);
        alert("Error al registrar la venta");
      });
    }
  </script>
</body>
</html>
