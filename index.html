<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ventas - NEXT</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: #fff;
      padding: 20px;
      margin-top: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }
    button {
      background-color: #28a745;
      color: white;
      border: none;
      padding: 12px;
      width: 100%;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #218838;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Registrar Venta</h2>
    <form id="ventaForm" onsubmit="registrarVenta(event)">
      <input type="text" id="cliente" placeholder="Cliente" required />
      <input type="text" id="telefono" placeholder="Teléfono" />
      <input type="text" id="producto" placeholder="Producto" />
      <input type="number" id="cantidad" placeholder="Cantidad" required />
      <input type="number" id="precio_unitario" placeholder="Precio Unitario" step="0.01" required />
      <input type="text" id="total_usd" placeholder="Total USD" readonly />
      <select id="metodo_pago_1">
        <option value="">Método de Pago 1</option>
        <option value="Efectivo">Efectivo</option>
        <option value="BS">BS</option>
        <option value="Zinli">Zinli</option>
        <option value="USDT">USDT</option>
      </select>
      <input type="number" id="monto_pago_1" placeholder="Monto Pago 1" step="0.01" />
      <select id="metodo_pago_2">
        <option value="">Método de Pago 2</option>
        <option value="Efectivo">Efectivo</option>
        <option value="BS">BS</option>
        <option value="Zinli">Zinli</option>
        <option value="USDT">USDT</option>
      </select>
      <input type="number" id="monto_pago_2" placeholder="Monto Pago 2" step="0.01" />
      <input type="number" id="tasa_bcv" placeholder="Tasa BCV" step="0.01" />
      <input type="text" id="abono_usd" placeholder="Abono USD" readonly />
      <input type="text" id="restante_usd" placeholder="Restante USD" readonly />
      <input type="text" id="asesor" placeholder="Asesor" />
      <textarea id="comentario" placeholder="Comentario"></textarea>
      <button type="submit">Registrar</button>
    </form>
  </div>
  <script>
    const endpoint = "https://script.google.com/macros/s/AKfycbxpaVldshku5oRYcyAxpzmeeW6fRZ2OCg0kTiYPS2I7L0bYMoDCSLND-42jcI9yX6u-QA/exec";

    function calcularTotales() {
      const cantidad = parseFloat(document.getElementById('cantidad').value) || 0;
      const precio = parseFloat(document.getElementById('precio_unitario').value) || 0;
      const total = cantidad * precio;
      document.getElementById('total_usd').value = total.toFixed(2);

      const pago1 = parseFloat(document.getElementById('monto_pago_1').value) || 0;
      const pago2 = parseFloat(document.getElementById('monto_pago_2').value) || 0;
      const abono = pago1 + pago2;
      document.getElementById('abono_usd').value = abono.toFixed(2);
      document.getElementById('restante_usd').value = (total - abono).toFixed(2);
    }

    document.querySelectorAll('#cantidad, #precio_unitario, #monto_pago_1, #monto_pago_2').forEach(el => {
      el.addEventListener('input', calcularTotales);
    });

    async function registrarVenta(e) {
      e.preventDefault();
      const form = document.getElementById('ventaForm');
      const data = {
        cliente: form.cliente.value,
        telefono: form.telefono.value,
        producto: form.producto.value,
        cantidad: form.cantidad.value,
        precio_unitario: form.precio_unitario.value,
        total_usd: form.total_usd.value,
        metodo_pago_1: form.metodo_pago_1.value,
        monto_pago_1: form.monto_pago_1.value,
        metodo_pago_2: form.metodo_pago_2.value,
        monto_pago_2: form.monto_pago_2.value,
        tasa_bcv: form.tasa_bcv.value,
        abono_usd: form.abono_usd.value,
        restante_usd: form.restante_usd.value,
        asesor: form.asesor.value,
        comentario: form.comentario.value,
      };

      try {
        const res = await fetch(endpoint, {
          method: "POST",
          body: JSON.stringify(data)
        });
        if (res.ok) {
          alert("Venta registrada exitosamente");
          form.reset();
        } else {
          alert("Error al registrar: " + res.statusText);
        }
      } catch (err) {
        alert("Error de conexión: " + err.message);
      }
    }
  </script>
</body>
</html>
