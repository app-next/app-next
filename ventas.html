
<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Registrar Venta</title>
<link href="estilos.css" rel="stylesheet"/>
</head>
<body>
<img alt="NEXT Logo" src="logo.png" style="max-width: 150px; margin: 1rem auto; display: block;"/>
<h2 style="text-align:center;">Registrar Venta</h2>
<form id="formulario">
<input name="cliente" placeholder="Cliente" required="" type="text"/>
<input name="telefono" placeholder="Teléfono" required="" type="text"/>
<input name="producto" placeholder="Producto" required="" type="text"/>
<input name="cantidad" placeholder="Cantidad" required="" type="number"/>
<input name="precio_unitario" placeholder="Precio Unitario" required="" type="number"/>
<input name="total_usd" placeholder="Total (USD)" readonly="" type="number"/>
<select name="metodo_pago_1"><option value="">Selecciona un método</option><option value="BS">Bolívares</option><option value="ZELLE">Zelle</option><option value="EFECTIVO">Efectivo</option><option value="PAGO MOVIL">Pago Móvil</option><option value="TRANSFERENCIA">Transferencia</option><option value="RESERVADO">Reservado</option><option value="DIVISA EFECTIVO">Divisa en efectivo</option></select>
<input name="monto_pago_1" placeholder="Monto Pago 1" type="number"/>
<select name="metodo_pago_2"><option value="">Selecciona un método</option><option value="BS">Bolívares</option><option value="ZELLE">Zelle</option><option value="EFECTIVO">Efectivo</option><option value="PAGO MOVIL">Pago Móvil</option><option value="TRANSFERENCIA">Transferencia</option><option value="RESERVADO">Reservado</option><option value="DIVISA EFECTIVO">Divisa en efectivo</option></select>
<input name="monto_pago_2" placeholder="Monto Pago 2 (opcional)" type="number"/>
<input name="tasa_bcv" placeholder="Tasa BCV (si aplica Bs)" step="0.01" type="number"/>
<input name="abono_usd" placeholder="Abono (USD)" readonly="" type="number"/>
<input name="restante_usd" placeholder="Restante (USD)" readonly="" type="number"/>
<input name="asesor" placeholder="Asesor" type="text"/>
<textarea name="comentario" placeholder="Comentario"></textarea>
<button type="submit">Registrar</button>
</form>
<p id="mensaje"></p>
<script>
    const formulario = document.getElementById("formulario");
    const mensaje = document.getElementById("mensaje");

    function calcularTotales() {
      const cantidad = parseFloat(formulario.cantidad.value) || 0;
      const precio = parseFloat(formulario.precio_unitario.value) || 0;
      const monto1 = parseFloat(formulario.monto_pago_1.value) || 0;
      const monto2 = parseFloat(formulario.monto_pago_2.value) || 0;
      const total = cantidad * precio;
      const abono = monto1 + monto2;
      const restante = total - abono;

      formulario.total_usd.value = total.toFixed(2);
      formulario.abono_usd.value = abono.toFixed(2);
      formulario.restante_usd.value = restante.toFixed(2);
    }

    formulario.cantidad.oninput = calcularTotales;
    formulario.precio_unitario.oninput = calcularTotales;
    formulario.monto_pago_1.oninput = calcularTotales;
    formulario.monto_pago_2.oninput = calcularTotales;

    formulario.onsubmit = async (e) => {
      e.preventDefault();
      mensaje.textContent = "";

      const datos = Object.fromEntries(new FormData(formulario).entries());

      if (datos.monto_pago_1 && !datos.metodo_pago_1) {
        mensaje.textContent = "Debes indicar el método de pago 1.";
        mensaje.style.color = "red";
        return;
      }
      if (datos.metodo_pago_1 && !datos.monto_pago_1) {
        mensaje.textContent = "Debes indicar el monto de pago 1.";
        mensaje.style.color = "red";
        return;
      }
      if ((datos.metodo_pago_1 === "BS" || datos.metodo_pago_2 === "BS") && !datos.tasa_bcv) {
        mensaje.textContent = "Debes indicar la tasa BCV si pagas en bolívares.";
        mensaje.style.color = "red";
        return;
      }

      try {
        const res = await fetch("https://script.google.com/macros/s/AKfycbxpaVldshku5oRYcyAxpzmeeW6fRZ2OCg0kTiYPS2I7L0bYMoDCSLND-42jcI9yX6u-QA/exec", {
          method: "POST",
          body: JSON.stringify(datos),
        });

        if (res.ok) {
          mensaje.textContent = "✅ Venta registrada correctamente.";
          mensaje.style.color = "green";
          formulario.reset();
        } else {
          mensaje.textContent = "❌ Error al registrar la venta.";
          mensaje.style.color = "red";
        }
      } catch (err) {
        mensaje.textContent = "❌ Error al registrar la venta.";
        mensaje.style.color = "red";
        console.error(err);
      }
    };
  </script>
</body>
</html>
