
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registrar Venta</title>
  <link rel="stylesheet" href="estilos.css">
</head>
<body>
  <img src="logo.png" alt="NEXT Logo" style="max-width: 150px; margin: 1rem auto; display: block;">
  <h2 style="text-align:center;">Registrar Venta</h2>
  <form id="formulario">
    <input name="fecha" type="date" required placeholder="Fecha" />
    <input name="cliente" type="text" required placeholder="Cliente" />
    <input name="telefono" type="text" required placeholder="Teléfono" />
    <input name="producto" type="text" required placeholder="Producto" />
    <input name="cantidad" type="number" required placeholder="Cantidad" />
    <input name="precio_unitario" type="number" required placeholder="Precio Unitario" />
    <input name="total_usd" type="number" readonly placeholder="Total (USD)" />
    <input name="metodo_pago_1" type="text" placeholder="Método de Pago 1" />
    <input name="monto_pago_1" type="number" placeholder="Monto Pago 1" />
    <input name="metodo_pago_2" type="text" placeholder="Método de Pago 2 (opcional)" />
    <input name="monto_pago_2" type="number" placeholder="Monto Pago 2 (opcional)" />
    <input name="tasa_bcv" type="number" step="0.01" placeholder="Tasa BCV (si aplica Bs)" />
    <input name="abono_usd" type="number" readonly placeholder="Abono (USD)" />
    <input name="restante_usd" type="number" readonly placeholder="Restante (USD)" />
    <input name="asesor" type="text" placeholder="Asesor" />
    <textarea name="comentario" placeholder="Comentario"></textarea>
    <button type="submit">Registrar</button>
  </form>
  <p id="mensaje"></p>

  <script>
    const formulario = document.getElementById("formulario");
    const mensaje = document.getElementById("mensaje");

    function calcularTotales() {
      const cantidad = parseFloat(formulario.cantidad.value) || 0;
      const precio = parseFloat(formulario.precio_unitario.value) || 0;
      const monto1 = parseFloat(formulario.monto_pago_1.value) || 0;
      const monto2 = parseFloat(formulario.monto_pago_2.value) || 0;
      const total = cantidad * precio;
      const abono = monto1 + monto2;
      const restante = total - abono;

      formulario.total_usd.value = total.toFixed(2);
      formulario.abono_usd.value = abono.toFixed(2);
      formulario.restante_usd.value = restante.toFixed(2);
    }

    formulario.cantidad.oninput = calcularTotales;
    formulario.precio_unitario.oninput = calcularTotales;
    formulario.monto_pago_1.oninput = calcularTotales;
    formulario.monto_pago_2.oninput = calcularTotales;

    formulario.onsubmit = async (e) => {
      e.preventDefault();
      mensaje.textContent = "";

      const datos = Object.fromEntries(new FormData(formulario).entries());

      if (datos.monto_pago_1 && !datos.metodo_pago_1) {
        mensaje.textContent = "Debes indicar el método de pago 1.";
        mensaje.style.color = "red";
        return;
      }
      if (datos.metodo_pago_1 && !datos.monto_pago_1) {
        mensaje.textContent = "Debes indicar el monto de pago 1.";
        mensaje.style.color = "red";
        return;
      }
      if ((datos.metodo_pago_1 === "BS" || datos.metodo_pago_2 === "BS") && !datos.tasa_bcv) {
        mensaje.textContent = "Debes indicar la tasa BCV si pagas en bolívares.";
        mensaje.style.color = "red";
        return;
      }

      try {
        const res = await fetch("https://script.google.com/macros/s/AKfycbxpaVldshku5oRYcyAxpzmeeW6fRZ2OCg0kTiYPS2I7L0bYMoDCSLND-42jcI9yX6u-QA/exec", {
          method: "POST",
          body: JSON.stringify(datos),
        });

        if (res.ok) {
          mensaje.textContent = "✅ Venta registrada correctamente.";
          mensaje.style.color = "green";
          formulario.reset();
        } else {
          mensaje.textContent = "❌ Error al registrar la venta.";
          mensaje.style.color = "red";
        }
      } catch (err) {
        mensaje.textContent = "❌ Error al registrar la venta.";
        mensaje.style.color = "red";
        console.error(err);
      }
    };
  </script>
</body>
</html>
